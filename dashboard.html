<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Dashboard - Área Restrita</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
            background-color: #f0f2f5;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 500px;
            text-align: center;
        }

        button {
            padding: 10px 20px;
            background-color: #ff4b4b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <!-- Proteção de rota -->
    <script type="module" src="./guard.js"></script>

    <div class="container">
        <h1>Bem-vindo ao Dashboard!</h1>
        <p>Esta é uma área protegida. Apenas usuários autenticados podem ver isso.</p>

        <div id="userInfo"
            style="margin-top: 20px; text-align: left; background: #eee; padding: 10px; border-radius: 4px; overflow-wrap: break-word;">
            Carregando dados do usuário...
        </div>

        <button id="logoutBtn">Sair (Logout)</button>
    </div>

    <script type="module">
        import { logoutUser, getUser } from './auth.js'

        const logoutBtn = document.getElementById('logoutBtn')
        const userInfoDiv = document.getElementById('userInfo')

        logoutBtn.addEventListener('click', async () => {
            await logoutUser()
        })

        async function displayUser() {
            const user = await getUser()
            if (user) {
                userInfoDiv.innerHTML = `
          <strong>Email:</strong> ${user.email} <br>
          <strong>ID:</strong> ${user.id} <br>
          <strong>Último Login:</strong> ${new Date(user.last_sign_in_at).toLocaleString()}
        `
            }
        }

        displayUser()
    </script>
</body>

</html>